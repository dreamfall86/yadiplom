# Дипломная работа по яндекс-курсу "Системный администратор" 
# Уважаемые ревьюверы, я немного не успел полностью автоматизировать проект, т.к. считаю, что ручная настройка - не уровень, поэтому для проверки отправил ссылку на свой репозиторий и попросил еще пару дней на окончательную подготовку и создание презентации, на данный момент всё полностью автоматизировано, и работает согласно нарисованной мной схеме, однако мне еще нужно разобраться со скриптом автоматического добавления всех мониторящихся хостов в конфиг zabbix-сервера

- Здесь будут содержаться файлы проекта
- Каждые 12 часов необходимо обновлять токен и переавторизироваться в аккаунте с помощью интерфейса CLI Yandex:
```
yc config set service-account-key key.json
yc config set cloud-id <идентификатор_облака>
yc config set folder-id <идентификатор_каталога>

export YC_TOKEN=$(yc iam create-token)
export YC_CLOUD_ID=$(yc config get cloud-id)
export YC_FOLDER_ID=$(yc config get folder-id)
```

- UPD: настроил автоматическое развертывание инфраструктуры и установку необходимых пакетов на каждую ВМ с помощью связки Ansible+Terraform, также написал 2 скрипта на python, с помощью которых, как раз, и происходит автоматизация:
     - скрипт start .../terraform/start выполняет развертывание инфраструктуры с помощью terraform и передаёт действия скрипту invent.py
     - скрипт invent.py .../ansible/invent.py выполняет автоматическое создание файла inventory.json для работы плейбуков Ansible
       
- Запуск инфраструктуры необходимо проивзодить с выполнения скрипта start.
- После развертывания выполнить плейбук Ansible из одноименной директории:
```
ansible-playbook -i inventory.json playbook.yml
```
- В текущий момент после выполнения работ необходимо выполнить удаление виртуального окружения:
```
terraform destroy
```

ADD to new BRANCH:
- добавил все плейбуки для автоматического развертывания и настройки облачного окружения.
- корректная работа ролей default/ ,mediawiki/ ,postgres/ , nginx/
- также допилил автоматическую настройку репликации с помощью Patroni
- ПРИ ПОЯВЛЕНИИ ОШИБОК dpkg ПРОСТО ПЕРЕЗАПУСТИТЬ ВМ!!!!!
- проверка кластера 
```
patronictl -c /etc/patroni/config.yml list
```
- исправил автоматическую настройку балансировщика nginx.
- все роли отрабатываются корректно, автоматическая настройка инфраструктуы, остлось разобраться с шаблонами для zabbix или добавлять метрики мониторинга вручную 
