# Дипломная работа по яндекс-курсу "Системный администратор" 

- Здесь будут содержаться файлы проекта
- Каждые 12 часов необходимо обновлять токен и переавторизироваться в аккаунте с помощью интерфейса CLI Yandex:
```
yc config set service-account-key key.json
yc config set cloud-id <идентификатор_облака>
yc config set folder-id <идентификатор_каталога>

export YC_TOKEN=$(yc iam create-token)
export YC_CLOUD_ID=$(yc config get cloud-id)
export YC_FOLDER_ID=$(yc config get folder-id)
```

- UPD: настроил автоматическое развертывание инфраструктуры и установку необходимых пакетов на каждую ВМ с помощью связки Ansible+Terraform, также написал 2 скрипта на python, с помощью которых, как раз, и происходит автоматизация:
     - скрипт start .../terraform/start выполняет развертывание инфраструктуры с помощью terraform и передаёт действия скрипту invent.py
     - скрипт invent.py .../ansible/invent.py выполняет автоматическое создание файла inventory.json для работы плейбуков Ansible
       
- Запуск инфраструктуры необходимо проивзодить с выполнения скрипта start.
- После развертывания выполнить плейбук Ansible из одноименной директории:
```
ansible-playbook -i inventory.json playbook.yml
```
- В текущий момент после выполнения работ необходимо выполнить удаление виртуального окружения:
```
terraform destroy
```

ADD to new BRANCH:
- добавил все плейбуки для автоматического развертывания и настройки облачного окружения.
- корректная работа ролей default/ ,mediawiki/ ,postgres/ , nginx/
- также допилил автоматическую настройку репликации с помощью Patroni
- ПРИ ПОЯВЛЕНИИ ОШИБОК dpkg ПРОСТО ПЕРЕЗАПУСТИТЬ ВМ!!!!!
- проверка кластера 
```
patronictl -c /etc/patroni/config.yml list
```
- исправил автоматическую настройку балансировщика nginx.
- все роли отрабатываются корректно, автоматическая настройка инфраструктуы
- очень много времени займёт разборка того, как автоматически присоединять агентов к серверу заббикс, однако нашёл автообнаружение и добавление через action
- не смог доработать плейбук установки агентов, постоянно сыпет ошибками и не находит конфигурационные файлы, решается в тупую ручной переустановкой агентов и изменением конфига с указанием ip сервера zabbix
